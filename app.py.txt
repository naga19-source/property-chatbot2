import streamlit as st
import requests
from bs4 import BeautifulSoup
import re

st.title("Simple Property Details Chatbot")

url = st.text_input("Paste Property Finder or Bayut URL here:")

def get_property_details(link):
    try:
        headers = {'User-Agent': 'Mozilla/5.0'}
        response = requests.get(link, headers=headers, timeout=10)
        soup = BeautifulSoup(response.text, "html.parser")

        title_tag = soup.find("h1")
        title = title_tag.get_text(strip=True) if title_tag else "Title not found"

        phone_tag = soup.find("a", href=lambda x: x and "tel:" in x)
        phone = phone_tag.get_text(strip=True) if phone_tag else "Contact not found"

        text = soup.get_text(separator=" ", strip=True)
        unit_match = re.search(r"(Unit|Office|Suite|#)\s*(\d+)", text, re.IGNORECASE)
        unit = unit_match.group(0) if unit_match else "Unit number not found"

        return title, phone, unit

    except Exception as e:
        return None, None, None

if url:
    with st.spinner("Fetching details..."):
        title, phone, unit = get_property_details(url)
        if title:
            st.write(f"**Title:** {title}")
            st.write(f"**Contact Number:** {phone}")
            st.write(f"**Unit Number:** {unit}")
        else:
            st.error("Sorry, couldn't fetch details from the link.")
