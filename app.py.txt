import streamlit as st
from playwright.sync_api import sync_playwright
from bs4 import BeautifulSoup
import re

def scrape_details(url):
    with sync_playwright() as p:
        browser = p.chromium.launch(headless=True)
        page = browser.new_page()
        page.goto(url, timeout=60000)
        page.wait_for_timeout(3000)

        soup = BeautifulSoup(page.content(), 'html.parser')
        title = soup.find("h1")
        title = title.get_text(strip=True) if title else "N/A"

        phone_tag = soup.find("a", href=lambda x: x and "tel:" in x)
        phone = phone_tag.get_text(strip=True) if phone_tag else "Not found"

        full_text = soup.get_text(separator=" ", strip=True)
        unit_match = re.search(r"(Unit|Office|Suite|#)\s*(\d{2,5})", full_text, re.IGNORECASE)
        unit_number = unit_match.group(0) if unit_match else "Not found"

        browser.close()
        return title, phone, unit_number

st.set_page_config(page_title="Property Chatbot")
st.title("üè¢ Property Link Chatbot")
st.write("Paste your Property Finder or Bayut link below:")

url = st.text_input("Property Listing URL")

if url:
    with st.spinner("Scraping info..."):
        try:
            title, phone, unit = scrape_details(url)
            st.success("‚úÖ Here are the details:")
            st.write(f"**Title:** {title}")
            st.write(f"**Contact Number:** {phone}")
            st.write(f"**Unit Number:** {unit}")
        except Exception as e:
            st.error(f"Error: {e}")